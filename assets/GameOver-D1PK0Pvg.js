import{j as e}from"./index-Bitz-2zT.js";import{u as O,e as W,b as m}from"./vendor-BpP_d66U.js";import{b as _}from"./banner-GS78naYI.js";import{g as z,i as K,q as v,c as $,w as f,o as P,l as J,a as V,s as X,b as Z}from"./firebase-Dn1EWF1c.js";import{g as ee}from"./data-BMgbbSwK.js";const te={apiKey:"AIzaSyAHVggGUuYsh0JFCKH6ageQ0UkwxcI0XAU",authDomain:"bluff-buster.firebaseapp.com",projectId:"bluff-buster",storageBucket:"bluff-buster.firebasestorage.app",messagingSenderId:"248989155364",appId:"1:248989155364:web:f3a6fd3c77c18ccfbdd8b1"},re=K(te),D=z(re),I=()=>new Date().toISOString().split("T")[0],ae=()=>{const t=new Date;return t.setDate(t.getDate()-7),t.toISOString().split("T")[0]},L=async(t=null,s=null)=>{try{const o=I(),a=ae();let n=v($(D,"leaderboard"),f("date",">=",a),f("date","<=",o),P("date","desc"),P("score","desc"),J(5));return t&&(n=v(n,f("category","==",t))),s&&(n=v(n,f("difficulty","==",s))),(await V(n)).docs.map(l=>({id:l.id,...l.data()}))}catch(o){throw console.error("Error fetching leaderboard:",o),o}},se=async t=>{try{const{name:s,score:o,category:a,difficulty:n}=t,d=I(),l={name:s,score:o,category:a,difficulty:n,date:d,timestamp:X()};return{id:(await Z($(D,"leaderboard"),l)).id,...l}}catch(s){throw console.error("Error adding score:",s),s}},oe=async(t,s=null,o=null)=>{try{if(t<1)return console.log("Score too low: Must have at least 1 point"),!1;const a=await L(s,o);if(console.log("Current leaderboard:",a),console.log("User score:",t),a.length<5)return console.log("Less than 5 entries, score qualifies"),!0;const n=a[a.length-1].score;console.log("Lowest score in leaderboard:",n);const d=t>n;return console.log("Qualifies:",d),d}catch(a){throw console.error("Error checking score qualification:",a),a}};function ne(){return console.log("production"),"/bluff-buster/#"}function le(t){const s=ne(),o=window.location.origin,a=t.startsWith("/")?t.slice(1):t;return`${o}${s}${a}`}function he(){const t=O(),s=W(),[o,a]=m.useState(!1),[n,d]=m.useState(!1),[l,j]=m.useState(""),[y,U]=m.useState([]),[p,x]=m.useState(!1),[E,q]=m.useState(!1),[w,T]=m.useState(!1),[N,h]=m.useState(null),{score:c=0,category:i="Unknown Category",timer:k=15,correctAnswer:ie,explanation:de}=s.state||{},S=ee(c,i),u=(r=>{switch(r){case 20:return"Easy";case 15:return"Medium";case 10:return"Hard";default:return"Medium"}})(k),C=r=>{const g=`/challenge?category=${encodeURIComponent(i)}&difficulty=${encodeURIComponent(u)}&score=${c}&name=${encodeURIComponent(l||"A friend")}`,F=le(g),R=`🔥 I just scored ${c} points in the "${i}" category on ${u} difficulty and earned the title "${S}"! 🏆 Think you can beat me? 😏 Play Bluff Buster now and prove it! 👉 ${F}`,b=encodeURIComponent(R),Q=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),M=/iPhone|iPad|iPod/i.test(navigator.userAgent),Y=/Android/i.test(navigator.userAgent);switch(r){case"whatsapp":const G=`https://wa.me/?text=${b}`,H=`whatsapp://send?text=${b}`;window.open(Q?H:G,"_blank");break;case"messages":M?window.open(`sms:&body=${b}`,"_blank"):Y&&window.open(`sms:?body=${b}`,"_blank");break;default:console.error("Unsupported platform:",r)}},A=async()=>{x(!0),h(null);try{console.log("Fetching leaderboard for:",{category:i,difficulty:u});const r=await L(i,u);console.log("Received leaderboard data:",r),U(r);const g=await oe(c,i,u);console.log("Score qualifies:",g),q(g)}catch(r){console.error("Error checking leaderboard:",r),h("Failed to load leaderboard. Please try again.")}finally{x(!1)}};m.useEffect(()=>{A()},[i,u,c]);const B=async()=>{if(l.trim()){x(!0),h(null);try{await se({name:l.trim(),score:c,category:i,difficulty:u}),d(!1),T(!0),await A()}catch(r){console.error("Error submitting score:",r),h("Failed to submit score. Please try again.")}finally{x(!1)}}};return e.jsxs("div",{className:"h-screen bg-white dark:bg-gray-900 flex flex-col items-center p-4 text-center transition-colors duration-200",children:[e.jsx("img",{src:_,alt:"Bluff Buster Banner",className:"w-20 sm:w-24 mb-2"}),e.jsxs("div",{className:"w-full max-w-4xl",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mb-1",children:"Leaderboard"}),e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"🏆"}),e.jsx("span",{className:"text-lg font-bold text-purple-800 dark:text-purple-400",children:"Top Scores"}),e.jsx("span",{className:"text-xl",children:"🏆"})]}),e.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-300 font-semibold text-center mt-1",children:["Category: ",e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:i})," | Difficulty: ",e.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:u})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:y.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm text-center text-sm text-gray-500 dark:text-gray-400 mb-3",children:"No scores yet. Be the first! 🚀"}):y.map((r,g)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-gray-600 dark:text-gray-300",children:["#",g+1]}),e.jsx("span",{className:"font-semibold text-sm text-gray-800 dark:text-gray-200",children:r.name})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-red-600 dark:text-red-400",children:r.score})})]},r.id))}),!p&&(E||y.length<5)&&!w&&c>0&&e.jsx("button",{className:"mt-3 w-full px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-sm hover:from-purple-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",onClick:()=>d(!0),disabled:w,children:"Add to Leaderboard"}),w&&e.jsx("p",{className:"mt-3 text-sm text-green-600 dark:text-green-400",children:"Your score has been submitted! 🎉"})]})}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-3 shadow-sm",children:e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mb-1",children:"Your Score"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-4xl font-bold text-red-600 dark:text-red-400",children:c})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg px-4 py-2 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Title Earned"}),e.jsx("p",{className:"text-lg font-semibold text-purple-600 dark:text-purple-400",children:S})]})]})]})})}),N&&e.jsx("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 px-3 py-2 rounded-lg mb-3 text-sm",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:N})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-base hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>t("/"),children:"New Game"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-base hover:from-purple-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>t("/beat-score",{state:{score:c,category:i,timer:k}}),children:"Beat the Score"})]}),e.jsx("button",{className:"w-full px-4 py-2 rounded-lg bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-base hover:from-pink-600 hover:to-pink-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>a(!0),children:"Challenge Friends"})]})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white rounded-xl p-4 w-80 text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-purple-800",children:"🎉 Congratulations!"}),e.jsx("p",{className:"text-sm mb-3",children:"Your score qualifies for the leaderboard!"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"text",placeholder:"Enter your name",className:"w-full p-2 border-2 border-purple-200 rounded-lg mb-1 focus:border-purple-500 focus:outline-none text-sm",value:l,onChange:r=>j(r.target.value),maxLength:20}),e.jsx("p",{className:"text-xs text-gray-500",children:"Your name will be visible on the leaderboard"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 px-3 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-sm hover:from-purple-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:B,disabled:!l.trim()||p,children:p?"Submitting...":"Submit"}),e.jsx("button",{className:"flex-1 px-3 py-2 rounded-lg bg-gradient-to-r from-gray-400 to-gray-500 text-white font-bold text-sm hover:from-gray-500 hover:to-gray-600 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>d(!1),disabled:p,children:"Cancel"})]})]})}),o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-4 w-80 text-center transition-colors duration-200",children:[e.jsx("h2",{className:"text-xl font-bold mb-3 text-purple-800 dark:text-purple-300",children:"Share with Friends"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-lg bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-sm hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>C("whatsapp"),children:"WhatsApp"}),e.jsx("button",{className:"px-3 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-sm hover:from-purple-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>C("messages"),children:"Messages"})]}),e.jsx("button",{className:"mt-3 w-full px-3 py-2 rounded-lg bg-gradient-to-r from-gray-400 to-gray-500 text-white font-bold text-sm hover:from-gray-500 hover:to-gray-600 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>a(!1),children:"Close"})]})})]})}export{he as default};
