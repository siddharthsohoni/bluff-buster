import{j as e}from"./index-CS9Yvndt.js";import{u as _,e as K,b as i}from"./vendor-D1mFCOAK.js";import{b as O}from"./banner-GS78naYI.js";import{i as J,g as P,a as V,c as L,q as w,w as v,o as U,l as X,b as Z,T as ee,d as te}from"./firebase-V7IZdzYi.js";const N={apiKey:"AIzaSyAHVggGUuYsh0JFCKH6ageQ0UkwxcI0XAU",authDomain:"bluff-buster.firebaseapp.com",projectId:"bluff-buster",storageBucket:"bluff-buster.firebasestorage.app",messagingSenderId:"248989155364",appId:"1:248989155364:web:f3a6fd3c77c18ccfbdd8b1"};console.log("Firebase Config:",{authDomain:N.authDomain,projectId:N.projectId,storageBucket:N.storageBucket});let j,k;try{j=J(N),k=P(j),console.log("Firebase initialized successfully")}catch{j=V(),k=P(j)}const F=async(t=null,n=null)=>{try{const a=new Date;a.setHours(23,59,59,999);const s=new Date(a);s.setDate(a.getDate()-7),s.setHours(0,0,0,0);const u=L(k,"leaderboard");let o=w(u,v("date",">=",s),v("date","<=",a),U("date","desc"),U("score","desc"));return t&&(o=w(o,v("category","==",t))),n&&(o=w(o,v("difficulty","==",n))),o=w(o,X(5)),(await Z(o)).docs.map(p=>({id:p.id,...p.data()}))}catch(a){throw new Error(`Failed to fetch leaderboard: ${a.message}`)}},ae=async t=>{try{const n={...t,date:new Date,timestamp:ee.now()},a=L(k,"leaderboard");return(await te(a,n)).id}catch(n){throw new Error(`Failed to add score: ${n.message}`)}},re=async(t,n=null,a=null)=>{try{if(!t||t<1)return!1;const s=await F(n,a);if(s.length<5)return!0;const u=Math.min(...s.map(o=>o.score));return t>u}catch(s){throw new Error(`Failed to check score qualification: ${s.message}`)}},se=t=>{const n=window.location.origin,a=t.startsWith("/")?t:`/${t}`,s=a.startsWith("/#")?a:`/#${a}`;return`${n}${s}`};function pe(){const t=_(),n=K(),[a,s]=i.useState(!1),[u,o]=i.useState(!1),[m,C]=i.useState(""),[p,B]=i.useState([]),[h,g]=i.useState(!1),[E,R]=i.useState(!1),[S,q]=i.useState(!1),[$,b]=i.useState(null),{score:l=0,category:d="Unknown Category",timer:A=15,correctAnswer:oe,explanation:ne,userTitle:f}=n.state||{},c=(r=>{switch(r){case 20:return"Easy";case 15:return"Medium";case 10:return"Hard";default:return"Medium"}})(A),D=r=>{const x=`challenge?category=${encodeURIComponent(d)}&difficulty=${encodeURIComponent(c)}&score=${l}&name=${encodeURIComponent(m||"A friend")}&title=${encodeURIComponent(f)}`,H=se(x),M=`🔥 I just scored ${l} points in the "${d}" category on ${c} difficulty and earned the title "${f}"! 🏆 Think you can beat me? 😏 Play Bluff Buster now and prove it! 👉 ${H}`,y=encodeURIComponent(M),Q=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),Y=/iPhone|iPad|iPod/i.test(navigator.userAgent),G=/Android/i.test(navigator.userAgent);switch(r){case"whatsapp":const W=`https://wa.me/?text=${y}`,z=`whatsapp://send?text=${y}`;window.open(Q?z:W,"_blank");break;case"messages":Y?window.open(`sms:&body=${y}`,"_blank"):G&&window.open(`sms:?body=${y}`,"_blank");break}},I=async()=>{g(!0),b(null);try{const r=await F(d,c);B(r);const x=await re(l,d,c);R(x)}catch(r){b(r.message||"Failed to load leaderboard. Please try again.")}finally{g(!1)}};i.useEffect(()=>{l&&d&&c&&I()},[d,c,l]);const T=async()=>{if(m.trim()){g(!0),b(null);try{await ae({name:m.trim(),score:l,category:d,difficulty:c}),o(!1),q(!0),await I()}catch(r){b(r.message||"Failed to submit score. Please try again.")}finally{g(!1)}}};return e.jsxs("div",{className:"h-screen bg-white dark:bg-gray-900 flex flex-col items-center p-4 text-center transition-colors duration-200",children:[e.jsx("img",{src:O,alt:"Bluff Buster Banner",className:"w-20 sm:w-24 mb-2"}),e.jsxs("div",{className:"w-full max-w-4xl",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-3 shadow-sm",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mb-1",children:"Leaderboard"}),e.jsxs("div",{className:"inline-flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:"🏆"}),e.jsx("span",{className:"text-lg font-bold text-purple-800 dark:text-purple-400",children:"Top Scores"}),e.jsx("span",{className:"text-xl",children:"🏆"})]}),e.jsxs("div",{className:"text-xs text-gray-700 dark:text-gray-300 font-semibold text-center mt-1",children:["Category: ",e.jsx("span",{className:"text-purple-700 dark:text-purple-300",children:d})," | Difficulty: ",e.jsx("span",{className:"text-blue-700 dark:text-blue-300",children:c})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-2",children:p.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm text-center text-sm text-gray-500 dark:text-gray-400 mb-3",children:"No scores yet. Be the first! 🚀"}):p.map((r,x)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-2 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-bold text-gray-600 dark:text-gray-300",children:["#",x+1]}),e.jsx("span",{className:"font-semibold text-sm text-gray-800 dark:text-gray-200",children:r.name})]}),e.jsx("div",{className:"text-right",children:e.jsx("div",{className:"font-bold text-red-600 dark:text-red-400",children:r.score})})]},r.id))}),!h&&(E||p.length<5)&&!S&&l>0&&e.jsx("button",{className:"mt-3 w-full px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-sm hover:from-purple-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100",onClick:()=>o(!0),disabled:S,children:"Add to Leaderboard"}),S&&e.jsx("p",{className:"mt-3 text-sm text-green-600 dark:text-green-400",children:"Your score has been submitted! 🎉"})]})}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 dark:from-gray-800 dark:to-gray-700 rounded-lg p-3 shadow-sm",children:e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("p",{className:"text-[10px] text-gray-500 dark:text-gray-400 mb-1",children:"Your Score"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-4xl font-bold text-red-600 dark:text-red-400",children:l})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg px-4 py-2 shadow-sm",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Title Earned"}),e.jsx("p",{className:"text-lg font-semibold text-purple-600 dark:text-purple-400",children:f})]})]})]})})}),$&&e.jsx("div",{className:"bg-red-100 dark:bg-red-900 border border-red-400 dark:border-red-700 text-red-700 dark:text-red-200 px-3 py-2 rounded-lg mb-3 text-sm",role:"alert",children:e.jsx("span",{className:"block sm:inline",children:$})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-base hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>t("/"),children:"New Game"}),e.jsx("button",{className:"px-4 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-base hover:from-purple-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>t("/beat-score",{state:{score:l,category:d,timer:A,userTitle:f}}),children:"Beat the Score"})]}),e.jsx("button",{className:"w-full px-4 py-2 rounded-lg bg-gradient-to-r from-pink-500 to-pink-600 text-white font-bold text-base hover:from-pink-600 hover:to-pink-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>s(!0),children:"Challenge Friends"})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white rounded-xl p-4 w-80 text-center",children:[e.jsx("h2",{className:"text-xl font-bold mb-2 text-purple-800",children:"🎉 Congratulations!"}),e.jsx("p",{className:"text-sm mb-3",children:"Your score qualifies for the leaderboard!"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"text",placeholder:"Enter your name",className:"w-full p-2 border-2 border-purple-200 rounded-lg mb-1 focus:border-purple-500 focus:outline-none text-sm",value:m,onChange:r=>C(r.target.value),maxLength:20}),e.jsx("p",{className:"text-xs text-gray-500",children:"Your name will be visible on the leaderboard"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"flex-1 px-3 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-sm hover:from-purple-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:T,disabled:!m.trim()||h,children:h?"Submitting...":"Submit"}),e.jsx("button",{className:"flex-1 px-3 py-2 rounded-lg bg-gradient-to-r from-gray-400 to-gray-500 text-white font-bold text-sm hover:from-gray-500 hover:to-gray-600 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>o(!1),disabled:h,children:"Cancel"})]})]})}),a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-xl p-4 w-80 text-center transition-colors duration-200",children:[e.jsx("h2",{className:"text-xl font-bold mb-3 text-purple-800 dark:text-purple-300",children:"Share with Friends"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"px-3 py-2 rounded-lg bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-sm hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>D("whatsapp"),children:"WhatsApp"}),e.jsx("button",{className:"px-3 py-2 rounded-lg bg-gradient-to-r from-purple-500 to-purple-600 text-white font-bold text-sm hover:from-purple-600 hover:to-purple-700 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>D("messages"),children:"Messages"})]}),e.jsx("button",{className:"mt-3 w-full px-3 py-2 rounded-lg bg-gradient-to-r from-gray-400 to-gray-500 text-white font-bold text-sm hover:from-gray-500 hover:to-gray-600 transform hover:scale-105 transition-all duration-200 shadow",onClick:()=>s(!1),children:"Close"})]})})]})}export{pe as default};
